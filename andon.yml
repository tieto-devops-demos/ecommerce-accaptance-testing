general:
  whitelist: true
  pipeline_base_name: eCommerceAcceptance
  dependency:
  #  - Catalog [PostStage]
  #  - Customer [PostStage]
  #  - Order [PostStage]
  #  - Zuul [PostStage]
   - AndroidApp [BuildAPK]

pre_stage:
 go_cd_agent_props:
   - ansible
 custom_cmd:
   - pip install robotframework
   - pip install robotframework-appiumlibrary

acceptance_testing:
  compose_file_path: dockerfiles
  compose_file_name: docker-compose.yml

  tests:
    go_cd_agent_props:
      - ansible
    test_services:
      service_virtualization: false
      robot_framework: true
      cucumber: false
    stages:
      - stage: DeployBitbarCloud
        jobs:
          - job: Deploy
            # selenium_grid: false
            # browser_stack: false
            tasks:
              - task: ansible-playbook -i inventory deploy.yml -e artifactory_url=https://maven.etb.tieto.com/artifactory/andon -e apikey=$TESTDROID_APIKEY -e build_id=$GO_DEPENDENCY_LABEL_ANDROIDAPP_MASTER -e username=$ARTIFACTORY_USER -e passwd=$ARTIFACTORY_PASSWD -vvvv
                build_path: ansible-scripts
                run_if_conditions: passed
      - stage: AcceptanceTesting
        jobs:
          - job: RobotFramework
            # selenium_grid: false
            # owasp_zap: true
            # browser_stack: false
            tasks:
              - task: robot --variable TESTDROID_APIKEY:$TESTDROID_APIKEY --variable BUILD_ID:$GO_DEPENDENCY_LABEL_ANDROIDAPP_MASTER ecommerce.robot
                build_path: robotframework
                run_if_conditions: passed
  selenium:
    version: "2.53.1"
    browsers:
    - name: chrome
      amount: 1
    - name: firefox
      amount: 1
